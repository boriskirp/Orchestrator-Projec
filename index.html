<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä POC: –ü–æ—Ä—Ç–∞–ª –ó–Ω–∞–Ω—å</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f4f7f6;
            color: #333;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        #editor-container, #notes-container, #music-player-container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        #editor, #notes-editor {
            min-height: 300px;
            border: 1px solid #e0e0e0;
            padding: 15px;
            font-size: 1.1em;
            line-height: 1.6;
            outline: none;
            cursor: text;
        }

        #editor:focus, #notes-editor:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }

        #popup {
            position: fixed;
            background-color: #ffffff;
            border: 1px solid #dcdcdc;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
            max-width: 280px;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 0.95em;
            color: #555;
            flex-direction: column;
            gap: 8px;
        }

        .popup-section-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            padding-bottom: 3px;
            border-bottom: 1px solid #eee;
        }

        .popup-info-content {
            padding: 5px 0;
            line-height: 1.4;
            color: #34495e;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .popup-action-button {
            display: block;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            color: #333;
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .popup-action-button:hover {
            background-color: #e2f0ff;
            border-color: #007bff;
            color: #007bff;
        }

        .general-info-message {
            color: #28a745;
            font-weight: bold;
            padding: 5px;
            text-align: center;
            line-height: 1.5;
        }
        
        .general-info-message small {
            display: block;
            margin-top: 10px;
            font-weight: normal;
            color: #555;
        }

        /* Styles for Music Player */
        #music-player-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        #audio-player {
            width: 100%;
            max-width: 500px;
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .audio-controls button {
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .audio-controls button:hover {
            background-color: #0056b3;
        }

        #url-input-group, #file-input-group {
            display: flex;
            width: 100%;
            max-width: 500px;
            gap: 10px;
        }

        #music-url-input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        #load-url-btn, #load-file-btn {
            padding: 8px 15px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        #load-url-btn:hover, #load-file-btn:hover {
            background-color: #5a6268;
        }

        #file-upload-label {
            padding: 8px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        #file-upload-label:hover {
            background-color: #218838;
        }

        #music-file-input {
            display: none;
        }
    </style>
</head>
<body>
    <h1>–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä POC: –í–∞—à –ü–æ—Ä—Ç–∞–ª –ó–Ω–∞–Ω—å</h1>

    <div id="editor-container">
        <div id="editor" contenteditable="true">
            <p>–í–∏–¥—ñ–ª—ñ—Ç—å –±—É–¥—å-—è–∫–∏–π —Ç–µ–∫—Å—Ç, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏, —è–∫ "–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä" –º–æ–∂–µ —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ –≤–∞—à—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ.</p>
            <p>–°–ø—Ä–æ–±—É–π—Ç–µ –≤–∏–¥—ñ–ª–∏—Ç–∏ —Å–ª–æ–≤–∞: **–º–∞—Ä–∫–µ—Ç–∏–Ω–≥**, **–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞**, **SEO**, **–∫–∞—Ä—Ç–∏–Ω–∫–∞**, **–≤—ñ–¥–µ–æ**, **–∫—É—Ä—Å –¥–æ–ª–∞—Ä–∞** –∞–±–æ **—á–∞—Å**.</p>
            <p>–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–≤–µ—Å—Ç–∏ –≤–ª–∞—Å–Ω–∏–π —Ç–µ–∫—Å—Ç, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "—â–æ —Ç–∞–∫–µ –º–µ—Ç–∞–≤—Å–µ—Å–≤—ñ—Ç?" –∞–±–æ "—ñ—Å—Ç–æ—Ä—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ–≥–æ –±–∞—Ä–æ–∫–æ", –≤–∏–¥—ñ–ª–∏—Ç–∏ –π–æ–≥–æ —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó –ø–æ—à—É–∫—É.</p>
            <p>–¶–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä, —Ü–µ –≤–∞—à **–ø–æ—Ä—Ç–∞–ª –¥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–ª–µ–∂–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ç–∞ –¥—ñ–π**.</p>
        </div>
    </div>
    
    <div id="popup"></div>

    ---

    <div id="notes-container">
        <h2>–ú–æ—ó –ù–æ—Ç–∞—Ç–∫–∏</h2>
        <div id="notes-editor" contenteditable="true">
            <p>–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ —Ä–æ–±–∏—Ç–∏ —Å–≤–æ—ó –Ω–æ—Ç–∞—Ç–∫–∏. –í–æ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ.</p>
        </div>
    </div>

    ---

    <div id="music-player-container">
        <h2>–ú—É–∑–∏—á–Ω–∏–π –ü—Ä–æ–≥—Ä–∞–≤–∞—á</h2>
        <audio id="audio-player" controls></audio>
        <div id="url-input-group">
            <input type="text" id="music-url-input" placeholder="–í–≤–µ–¥—ñ—Ç—å URL –º—É–∑–∏–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, .mp3, .wav)">
            <button id="load-url-btn">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–∞ URL</button>
        </div>
        <div id="file-input-group">
            <input type="file" id="music-file-input" accept="audio/*">
            <label for="music-file-input" id="file-upload-label">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ –ü–ö</label>
        </div>
        <div class="audio-controls">
            <button id="play-btn">–í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏</button>
            <button id="pause-btn">–ü–∞—É–∑–∞</button>
            <button id="stop-btn">–ó—É–ø–∏–Ω–∏—Ç–∏</button>
        </div>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const popup = document.getElementById('popup');
        const notesEditor = document.getElementById('notes-editor');
        const audioPlayer = document.getElementById('audio-player');
        const musicUrlInput = document.getElementById('music-url-input');
        const loadUrlBtn = document.getElementById('load-url-btn');
        const musicFileInput = document.getElementById('music-file-input');
        const playBtn = document.getElementById('play-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const stopBtn = document.getElementById('stop-btn');

        // –ë–∞–∑–∞ –∑–Ω–∞–Ω—å: "–°—É—Ç—å" + "–°–µ—Ä–≤—ñ—Å–∏/–ü—Ä–∞–≤–∏–ª–∞/–ü–æ—à—É–∫"
        const fakeKnowledgeBase = {
            "–º–∞—Ä–∫–µ—Ç–∏–Ω–≥": [
                { type: "info", content: "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ ‚Äì —Ü–µ –∫–æ–º–ø–ª–µ–∫—Å –¥—ñ–π, —Å–ø—Ä—è–º–æ–≤–∞–Ω–∏—Ö –Ω–∞ –ø—Ä–æ—Å—É–≤–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤/–ø–æ—Å–ª—É–≥ —Ç–∞ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è –ø–æ—Ç—Ä–µ–± —Å–ø–æ–∂–∏–≤–∞—á—ñ–≤." },
                { type: "link", title: "Google Ads (—Ä–µ–∫–ª–∞–º–∞)", url: "https://ads.google.com/", icon: "üåê" },
                { type: "link", title: "Mailchimp (email-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥)", url: "https://mailchimp.com/", icon: "üìß" },
                { type: "link", title: "–û—Å–Ω–æ–≤–∏ digital-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É (—Å—Ç–∞—Ç—Ç—è)", url: "https://blog.hubspot.com/marketing/what-is-digital-marketing", icon: "üìö" }
            ],
            "–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞": [
                { type: "info", content: "–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –¥–∞–Ω–∏—Ö ‚Äì —Ü–µ –ø—Ä–æ—Ü–µ—Å –≤–∏–≤—á–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –∑–∞–∫–æ–Ω–æ–º—ñ—Ä–Ω–æ—Å—Ç–µ–π, –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Å–∞–π—Ç—ñ–≤ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –ø—Ä–∏–π–Ω—è—Ç—Ç—è —Ä—ñ—à–µ–Ω—å." },
                { type: "link", title: "Google Analytics (–≤–µ–±-–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞)", url: "https://analytics.google.com/", icon: "üìä" },
                { type: "link", title: "Power BI (–±—ñ–∑–Ω–µ—Å-–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞)", url: "https://powerbi.microsoft.com/uk-ua/", icon: "üìà" },
                { type: "link", title: "–Ø–∫ —á–∏—Ç–∞—Ç–∏ –¥–∞—à–±–æ—Ä–¥–∏ (—Å—Ç–∞—Ç—Ç—è)", url: "https://www.tableau.com/learn/articles/what-is-data-dashboard", icon: "üìñ" }
            ],
            "seo": [
                { type: "info", content: "SEO (Search Engine Optimization) ‚Äì —Ü–µ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —Å–∞–π—Ç—É –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –π–æ–≥–æ –ø–æ–∑–∏—Ü—ñ–π —É –ø–æ—à—É–∫–æ–≤–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö." },
                { type: "link", title: "Google Search Console", url: "https://search.google.com/search-console/", icon: "üîç" },
                { type: "link", title: "Ahrefs (—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç SEO)", url: "https://ahrefs.com/", icon: "üõ†Ô∏è" },
                { type: "link", title: "–ü—Ä–∞–≤–∏–ª–∞ SEO –≤—ñ–¥ Google (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è)", url: "https://developers.google.com/search/docs/fundamentals/seo-starter-guide", icon: "‚öôÔ∏è" }
            ],
            "–∫–∞—Ä—Ç–∏–Ω–∫–∞": [ 
                { type: "info", content: "–í—ñ–∑—É–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —ñ–ª—é—Å—Ç—Ä–∞—Ü—ñ–π, —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —á–∏ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è." },
                { type: "search_link", title: "–®—É–∫–∞—Ç–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ Google Images", url: "https://www.google.com/search?tbm=isch&q=", icon: "üñºÔ∏è" },
                { type: "link", title: "–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ —Ñ–æ—Ç–æ (Unsplash)", url: "https://unsplash.com/", icon: "üì∏" }
            ],
            "–≤—ñ–¥–µ–æ": [ 
                { type: "info", content: "–î–∏–Ω–∞–º—ñ—á–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è, —Ä–æ–∑–≤–∞–≥ —Ç–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó." },
                { type: "search_link", title: "–ü–æ—à—É–∫ –≤—ñ–¥–µ–æ –Ω–∞ YouTube", url: "https://www.youtube.com/results?search_query=", icon: "‚ñ∂Ô∏è" },
                { type: "link", title: "–û—Å–≤—ñ—Ç–Ω—ñ –≤—ñ–¥–µ–æ (Khan Academy)", url: "https://www.khanacademy.org/", icon: "üéì" }
            ],
            "–∫—É—Ä—Å –¥–æ–ª–∞—Ä–∞": [
                { type: "info", content: "–ê–∫—Ç—É–∞–ª—å–Ω–∏–π –∫—É—Ä—Å –¥–æ–ª–∞—Ä–∞: 39.85 UAH (—Å—Ç–∞–Ω–æ–º –Ω–∞ 21.05.2025)." },
                { type: "link", title: "–î–∏–≤–∏—Ç–∏—Å—è –∫—É—Ä—Å –Ω–∞ —Å–∞–π—Ç—ñ –ù–ë–£", url: "https://bank.gov.ua/ua/markets/exchangerates", icon: "üè¶" }
            ],
            "—á–∞—Å": [
                { type: "info", content: () => `–ü–æ—Ç–æ—á–Ω–∏–π —á–∞—Å —É –ü–æ–∫—Ä–æ–≤—ñ: ${new Date().toLocaleTimeString('uk-UA', { timeZone: 'Europe/Kyiv' })}.` } 
            ],
            "–Ω–æ–≤–∏–Ω–∏": [
                { type: "info", content: "–ê–∫—Ç—É–∞–ª—å–Ω—ñ –ø–æ–¥—ñ—ó —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∑—ñ —Å–≤—ñ—Ç—É." },
                { type: "link", title: "–ù–æ–≤–∏–Ω–∏ –£–∫—Ä–∞—ó–Ω–∏ (–£–∫—Ä—ñ–Ω—Ñ–æ—Ä–º)", url: "https://www.ukrinform.ua/", icon: "üì∞" },
                { type: "link", title: "–°–≤—ñ—Ç–æ–≤—ñ –Ω–æ–≤–∏–Ω–∏ (BBC News)", url: "https://www.bbc.com/news", icon: "üåç" }
            ]
        };

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É –ø–æ–ø–∞–ø—É
        function showPopup(x, y, contentHtml) {
            popup.innerHTML = contentHtml;
            popup.style.left = `${x}px`;
            popup.style.top = `${y}px`;
            popup.style.display = 'flex';
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–æ–ø–∞–ø—É
        function hidePopup() {
            popup.style.display = 'none';
        }

        // –û–±—Ä–æ–±–Ω–∏–∫ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
        editor.addEventListener('mouseup', (event) => {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();
            const lowerCaseSelectedText = selectedText.toLowerCase();

            if (selectedText.length === 0) {
                hidePopup();
                return;
            }

            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            
            if (!editor.contains(event.target)) {
                hidePopup();
                return;
            }

            let infos = [];
            let actions = [];

            if (fakeKnowledgeBase[lowerCaseSelectedText]) {
                fakeKnowledgeBase[lowerCaseSelectedText].forEach(item => {
                    if (item.type === "info") infos.push(item);
                    else actions.push(item);
                });
            } else {
                for (const key in fakeKnowledgeBase) {
                    if (lowerCaseSelectedText.includes(key) || key.includes(lowerCaseSelectedText)) {
                        fakeKnowledgeBase[key].forEach(item => {
                            if (item.type === "info" && !infos.some(i => i.content === item.content)) infos.push(item);
                            else if (!actions.includes(item)) actions.push(item);
                        });
                    }
                }
            }

            let popupContentHtml = '';

            if (infos.length > 0 || actions.length > 0) {
                if (infos.length > 0) {
                    popupContentHtml += `<div class="popup-section-title">–°—É—Ç—å:</div>`;
                    infos.forEach(info => {
                        const content = typeof info.content === 'function' ? info.content() : info.content;
                        popupContentHtml += `<div class="popup-info-content">${content}</div>`;
                    });
                }

                if (actions.length > 0) {
                    popupContentHtml += `<div class="popup-section-title">–î—ñ—ó / –†–µ—Å—É—Ä—Å–∏:</div>`;
                    actions.forEach(action => {
                        let url = action.url;
                        if (action.type === "search_link") { 
                            url += encodeURIComponent(selectedText);
                        }
                        popupContentHtml += `<a href="${url}" target="_blank" class="popup-action-button">${action.icon || 'üîó'} ${action.title}</a>`;
                    });
                }
            } else {
                popupContentHtml = `<div class="general-info-message">
                                        –¶–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä,<br>
                                        —Ü–µ –≤–∞—à **–ø–æ—Ä—Ç–∞–ª –¥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–ª–µ–∂–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ç–∞ –¥—ñ–π**.<br>
                                        <small>–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ–π –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –∞–ª–µ –≤–∏ –º–æ–∂–µ—Ç–µ:</small>
                                    </div>`;
            }

            // –ó–ú–Ü–ù–ê –¢–£–¢: –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ Gemini —Ç–µ–ø–µ—Ä —è–∫ –∑–≤–∏—á–∞–π–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
            popupContentHtml += `<a href="https://gemini.google.com/chat?q=${encodeURIComponent(selectedText)}" target="_blank" class="popup-action-button">‚ú® –ó–∞–ø–∏—Ç–∞—Ç–∏ Gemini –ø—Ä–æ "${selectedText}"</a>`;
            
            // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –ø–æ—à—É–∫—É, —è–∫—â–æ –Ω–µ–º–∞—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ–π
            if (infos.length === 0 && actions.length === 0) {
                popupContentHtml += `<a href="https://www.google.com/search?q=${encodeURIComponent(selectedText)}" target="_blank" class="popup-action-button">üîç –®—É–∫–∞—Ç–∏ "${selectedText}" –≤ Google</a>`;
                popupContentHtml += `<a href="https://uk.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(selectedText)}" target="_blank" class="popup-action-button">üìö –®—É–∫–∞—Ç–∏ "${selectedText}" —É Wikipedia</a>`;
            }
            
            showPopup(rect.right + window.scrollX + 10, rect.top + window.scrollY, popupContentHtml);
        });

        // –•–æ–≤–∞—î–º–æ –ø–æ–ø–∞–ø, —è–∫—â–æ –∫–ª—ñ–∫–Ω—É—Ç–æ –¥–µ—Å—å –∑–∞ –º–µ–∂–∞–º–∏ –ø–æ–ø–∞–ø—É —Ç–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        document.addEventListener('mousedown', (event) => {
            if (!popup.contains(event.target) && !editor.contains(event.target)) {
                hidePopup();
            }
        });

        // –•–æ–≤–∞—î–º–æ –ø–æ–ø–∞–ø, –∫–æ–ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤—Ç—Ä–∞—á–∞—î —Ñ–æ–∫—É—Å —ñ –Ω—ñ—á–æ–≥–æ –Ω–µ –≤–∏–¥—ñ–ª–µ–Ω–æ
        editor.addEventListener('blur', () => {
            const selection = window.getSelection();
            if (selection.toString().trim().length === 0) {
                hidePopup();
            }
        });

        // –•–æ–≤–∞—î–º–æ –ø–æ–ø–∞–ø, –∫–æ–ª–∏ –∫—É—Ä—Å–æ—Ä –ø–æ–∫–∏–¥–∞—î –π–æ–≥–æ (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞)
        popup.addEventListener('mouseout', (event) => {
            if (!popup.contains(event.relatedTarget) && !editor.contains(event.relatedTarget)) {
                hidePopup();
            }
        });
        
        // –ü–µ—Ä–µ–∫–æ–Ω–∞—î–º–æ—Å—è, —â–æ –ø–æ–ø–∞–ø –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤–∏–¥–∏–º–∏–º, –∫–æ–ª–∏ –∫—É—Ä—Å–æ—Ä –Ω–∞–¥ –Ω–∏–º
        popup.addEventListener('mouseover', () => {
            // –ù—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏–º–æ
        });

        // --- –ù–æ—Ç–∞—Ç–∫–∏ ---
        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ—Ç–∞—Ç–æ–∫ –∑ Local Storage
        const savedNotes = localStorage.getItem('orchestratorNotes');
        if (savedNotes) {
            notesEditor.innerHTML = savedNotes;
        }

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–æ—Ç–∞—Ç–æ–∫ –ø—Ä–∏ –∑–º—ñ–Ω—ñ
        notesEditor.addEventListener('input', () => {
            localStorage.setItem('orchestratorNotes', notesEditor.innerHTML);
        });

        // --- –ú—É–∑–∏—á–Ω–∏–π –ü—Ä–æ–≥—Ä–∞–≤–∞—á ---
        loadUrlBtn.addEventListener('click', () => {
            const url = musicUrlInput.value.trim();
            if (url) {
                audioPlayer.src = url;
                audioPlayer.load();
                audioPlayer.play();
            } else {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å URL –º—É–∑–∏—á–Ω–æ–≥–æ —Ñ–∞–π–ª—É.');
            }
        });

        musicFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const fileURL = URL.createObjectURL(file);
                audioPlayer.src = fileURL;
                audioPlayer.load();
                audioPlayer.play();
            }
        });

        playBtn.addEventListener('click', () => {
            audioPlayer.play();
        });

        pauseBtn.addEventListener('click', () => {
            audioPlayer.pause();
        });

        stopBtn.addEventListener('click', () => {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
        });

    </script>
</body>
</html>